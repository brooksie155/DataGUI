<?php
/**
 * Abstract gateway adapter, managers basic commands must be extended in order t * apply connection details
 *
 * Requires HttpRequest
 * @see http://php.net/manual/en/http.setup.php
 *
 * @author Stephen Brooks
 */
abstract class Gateway_Abstract
{
  
  /**
   * Reference to the instance constaining connection information
   * @var Helper_Abstract
   */
  private $_helper;
  
  /**
   * @var array $_options
   */
  private $_options;
  
  
  /**
   * getter for request options
   *
   * @author Stephen Brooks
   * @return Array
   */
  public function getParameters()
  {
    return $this->_options;
  }
    
    
  /**
   * Set options to be sent with the request
   *
   * @author Stephen Brooks
   * @param String $key
   * @param String $value
   */
  public function setParameters($key, $value)
  {
    $this->_options[$key] = $value;
  }
  
  
  /**
   * setter for the helper instance
   *
   * @author  Stephen Brooks
   * @param   Helper_Abstract
   * @return  Gateway_Abstract
   */
  public function setHelper(Helper_Abstract $helper)
  {
    $this->_helper = $helper;
    
    return $this;
  }
  
  /**
   * getter for the helper instance
   *
   * @author Stephen Brooks
   * @return Helper_Abstract
   * @throws Gateway_Exception
   */
  public function getHelper()
  {
    if (!$this->_helper instanceof Helper_Abstract) {
      throw new Gateway_Exception('configuration helper not set.');
    }
    
    return $this->_helper;
  }
  
  /**
   * set GET request, return response or throws response error
   *
   * @author Stephen Brooks
   * @return String response
   * @throws Gateway_Exception
   */
  public function cmdGet()
  {

    $request = new HttpRequest($this->getHelper()->getGatewayUrl());
    $request->setQueryData($this->getParameters());
    $request->addHeaders($this->getHelper()->getHeaders());
    $request->setMethod(HTTP_METH_GET);
    $request->send();
    
    if ($request->getResponseCode() == 200) {
      return $request->getResponseBody();
    } else {
      throw new Gateway_Exception(
        "Connection Error [{$request->getResponseCode()}] {$request->getResponseStatus()}"
      );
    }
  
  }
  
  
}
